# 仿真工具

## 命令用法

### 主命令

```
v2sim (-d | --dir | --proj-dir <配置文件文件夹>) \
    [-o | --out | --out-dir <输出文件夹>] \
    [-b <开始时间>] \
    [-l <交通仿真步长>] \
    [-e <结束时间>] \
    [--break-at <中断时间>] \
    [--seed <随机种子>] \
    [--log | --logging-items <要记录的数据>] \
    [--no-plg | --disable-plugins <要禁用的插件>] \
    [--gen-veh <重新生成命令>] \
    [--gen-fcs <重新生成命令>] \
    [--gen-scs <重新生成命令>] \
    [--plot-script <绘图命令>] \
    [--initial-state <状态文件夹> | --load-last-state | --load-case-state] \
    [--save-on-abort] \
    [--save-on-finish] \
    [--uxsim-show-info] \
    [--uxsim-randomize] \
    [--uxsim-no-parallel] \
    [--sumo-ignore-driving] \
    [--sumo-raise-routing-error] \
    [--copy-proj-to-out] \
    [--copy-state-to-proj] \
    [--route-algo <算法>] \
    [--show] \
    [--no-daemon] \
    [--debug]
```

### 替代的 Python 用法
```bash
v2sim [--file <文件>]
v2sim [--ls-com]
```

## 独立参数
以下参数应单独使用，不能与其他参数组合：

- **`--file <文件>`**：从外部文件读取参数并串行执行命令行仿真。文件内容应为空格分隔的参数列表。如果文件有多行，则只考虑第一行。
  - 示例文件内容：`"-d 12nodes -b 0 -e 172800"`

- **`--ls-com`**：列出所有可用的插件和记录项。

## 单次仿真参数

### 核心参数
- **`-d <配置文件夹>`**：**必需**。包含网络、车辆和充电站文件的配置文件夹。

- **`-b <开始时间>`**：开始时间（秒）。默认从 SUMO 配置读取。

- **`-e <结束时间>`**：结束时间（秒）。默认从 SUMO 配置读取。

- **`-l <数据记录步长>`**：数据记录步长（秒）。默认为 10 秒。

- **`-o <输出文件夹>`**：输出文件夹。当前目录下的 'results' 文件夹是默认输出文件夹。

- **`--break-at <中断时间>`**：当提供此参数时，仿真将在指定的中断时间结束，而不是在设定的结束时间结束。该参数用于从保存的状态恢复 UXsim 仿真。通过指定不同的中断时间和结束时间，您可以在中途暂停 UXsim 仿真。UXsim 在开始时需要一个准确的结束时间，它无法在给定的结束时间之后继续进行仿真。SUMO 不需要此参数，因为其仿真结束时间不是一个硬性限制。

### 随机化与日志记录
- **`--seed <随机种子>`**：用于生成车辆、充电站和 SUMO 的随机种子。默认值为0。

- **`--log <要记录的数据>`**：要记录的数据，包括：
  - `ev`：电动汽车
  - `fcs`：快充站
  - `scs`：慢充站
  - `gs`：加油站
  - `gen`：发电机
  - `bus`：母线
  - `line`：输电线路
  
  多个数据类型用逗号分隔。默认为 "fcs,scs"。

### 插件管理
- **`--no-plg <要禁用的插件>`**：禁用特定插件。多个插件应用逗号分隔。默认不禁用任何插件。

### 文件生成与重新生成
- **`--gen-veh <命令>`**：重新生成电动汽车文件的命令行。如果未给出，则不会重新生成文件（默认行为）。

- **`--gen-fcs <命令>`**：重新生成快充站文件的命令行。如果未给出，则不会重新生成文件（默认行为）。

- **`--gen-scs <命令>`**：重新生成慢充站文件的命令行。如果未给出，则不会重新生成文件（默认行为）。

### 状态管理
- **`--initial-state <文件夹>`**：包含初始状态文件的文件夹。如果未给出，初始状态将由 SUMO 的默认行为设计。

- **`--load-last-state`**：从该案例的上次仿真中加载保存的状态。如果启用此选项，`initial-state` 选项将被忽略。

- **`--save-on-abort`**：当仿真中止时（例如通过 Ctrl+C）保存仿真状态。

- **`--save-on-finish`**：当仿真正常完成时保存仿真状态。

### 输出与配置
- **`--copy-proj-to-out`**：仿真结束后将配置文件复制到输出文件夹。默认不启用。

- **`--copy-state-to-proj`**：仿真结束后将状态文件复制到案例文件夹。默认不启用。

- **`--plot-script <命令>`**：仿真完成后用于图形绘图的命令行。

### 路径规划与算法
- **`--route-algo <算法>`**：路径规划算法。选项有：
  - `"astar"`（默认）
  - `"dijkstra"`
  - `"CH"`（仅 SUMO）
  - `"CHWrapper"`（仅 SUMO）

## 图形仿真参数（仅 SUMO）

- **`--show`**：启用 GUI 模式。**注意**：此选项仅在 Linux 中有用。在 Windows 中，请调整 `v2sim/sim/win_vis.py` 中的 `WINDOWS_VISUALIZE` 来更改可见性级别。

- **`--no-daemon`**：将仿真线程与显示窗口分离。当未启用时，一旦显示窗口关闭，仿真将停止。

- **`--debug`**：启用图形仿真的调试模式。当图形仿真失败时，将输出详细的错误信息。

## UXsim 参数
- **`--uxsim-show-info`**：显示 UXsim 的进度信息，而非 V2Sim 的进度信息。

- **`--uxsim-randomize`**：使用由 `--seed` 指定的随机种子，对 UXsim 的交通流进行随机化处理。

- **`--uxsim-no-parallel`**：即使路网已被分割成多个区域，也禁用并行仿真。分割后的区域将被视为一个整体进行处理。

## SUMO 参数

- **`--sumo-ignore-driving`**：如果启用，电动汽车的电池电量将仅在到达出行目的地时扣除。否则，每个仿真步长都会计算一次电量消耗。

- **`--sumo-raise-routing-error`**：如果启用，当 SUMO 无法在给定位置之间找到路线时，它将引发异常并终止仿真。

## 错误处理

- 无效参数将触发立即终止，并显示描述性错误消息
- 缺失必需文件将报告具体的文件名
- 仿真中断（Ctrl+C）可以配置为自动保存状态
- 插件加载失败会被报告但不一定会停止仿真